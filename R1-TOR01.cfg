hostname R1-TOR01
boot nxos bootflash:nxos.9.3.8.bin
policy-map type network-qos jumboframes
  class type network-qos class-default
    mtu 9216
vdc R1-TOR01 id 1
  limit-resource vlan minimum 16 maximum 4094
  limit-resource vrf minimum 2 maximum 4096
  limit-resource port-channel minimum 0 maximum 511
  limit-resource m4route-mem minimum 58 maximum 58
  limit-resource m6route-mem minimum 8 maximum 8

nv overlay evpn
feature ospf
feature bgp
feature pim
feature fabric forwarding
feature interface-vlan
feature vn-segment-vlan-based
feature nv overlay

no password strength-check
username admin password 0 admin role network-admin
ip domain-lookup
system qos
  service-policy type network-qos jumboframes

fabric forwarding anycast-gateway-mac 0000.1111.1111
ip pim rp-address 10.255.0.123 group-list 239.0.0.0/8
ip pim ssm range 232.0.0.0/8
vlan 1,100,555
vlan 100
  name Public_VLAN
  vn-segment 10100
vlan 555
  name L3VNI-For-IRB
  vn-segment 10555

vrf context ISP
  description VRF-ISP
  vni 10555
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn
vrf context management

interface Vlan1

interface Vlan100
  description  Anycast Gateway For Public  
  no shutdown
  mtu 9216
  vrf member ISP
  no ip redirects
  ip address 69.25.124.1/24
  fabric forwarding mode anycast-gateway

interface Vlan555
  description  L3VNI-For-IRB 
  no shutdown
  mtu 9216
  vrf member ISP
  ip forward
  ipv6 address use-link-local-only

interface nve1
  no shutdown
  host-reachability protocol bgp
  source-interface loopback1
  member vni 10100
    mcast-group 239.1.1.100
  member vni 10555 associate-vrf

interface port-channel999
  description  vPC Peer-Link 
  switchport mode trunk
  switchport trunk allowed vlan 60-61,100,444,555
  spanning-tree port type network
  vpc peer-link

interface Ethernet1/1
  description SPINE01
  no switchport
  mtu 9216
  medium p2p
  ip unnumbered loopback0
  ip router ospf UNDERLAY-NET area 0.0.0.0
  ip pim sparse-mode
  no shutdown

interface Ethernet1/2
  description SPINE02
  no switchport
  mtu 9216
  medium p2p
  ip unnumbered loopback0
  ip router ospf UNDERLAY-NET area 0.0.0.0
  ip pim sparse-mode
  no shutdown

interface Ethernet1/3
  no switchport
  vrf member ISP
  ip address 101.101.101.102/30
  no shutdown

interface Ethernet1/9
  description vPC Peer-Link
  switchport mode trunk
  switchport trunk allowed vlan 60-61,100,444,555
  channel-group 999 mode active

interface Ethernet1/10
  description vPC Peer-Link
  switchport mode trunk
  switchport trunk allowed vlan 60-61,100,444,555
  channel-group 999 mode active

interface mgmt0
  vrf member management

interface loopback0
  description  RID/BGP Overlay 
  ip address 10.255.1.1/32
  ip router ospf UNDERLAY-NET area 0.0.0.0
  ip pim sparse-mode

interface loopback1
  description  VTEP/Overlay 
  ip address 10.255.255.1/32
  ip router ospf UNDERLAY-NET area 0.0.0.0
  ip pim sparse-mode
icam monitor scale

cli alias name wr copy run start
line console
line vty
boot nxos bootflash:/nxos64-cs.10.3.1.F.bin
router ospf UNDERLAY-NET
  log-adjacency-changes
router bgp 65001
  router-id 10.255.1.2
  log-neighbor-changes
  template peer VXLAN_SPINE
    remote-as 65001
    update-source loopback0
    address-family ipv4 unicast
    address-family l2vpn evpn
      send-community
      send-community extended
  neighbor 10.255.0.1
    inherit peer VXLAN_SPINE
    description SPINE01
    no shutdown
  neighbor 10.255.0.2
    inherit peer VXLAN_SPINE
    description SPINE02
    no shutdown
  vrf ISP
    log-neighbor-changes
    address-family ipv4 unicast
      aggregate-address 69.25.124.0/24 summary-only
    neighbor 101.101.101.101
      remote-as 88888
      local-as 99999
      description  ISP eBGP peer 
      address-family ipv4 unicast
        send-community
        send-community extended
evpn
  vni 10100 l2
    rd auto
    route-target import auto
    route-target export auto